id: 012eb968-e871-4029-8096-a63044a42029
alias: "F2O - Tun off desk Martijn switch"
trigger:
  - platform: state
    entity_id:
      - binary_sensor.computer_zolder
      - binary_sensor.laptop_werk_martijn_lan
      - binary_sensor.laptop_werk_martijn_wifi
      - media_player.zolder_werkkamer_stereo
    to:
      - "idle"
      - "off"
    for: "00:30:00"
  - platform: numeric_state
    entity_id: sensor.battery
    above: 95
  - platform: template
    value_template: >
      {{
        states('sensor.iphone_van_martijn_battery_level') | float(0) > 95
        and is_state('binary_sensor.iphone_martijn_on_charger', 'on')
      }}
condition:
  - alias: "Everyting off?"
    condition: state
    entity_id:
      - binary_sensor.computer_zolder
      - binary_sensor.laptop_werk_martijn_lan
      - binary_sensor.laptop_werk_martijn_wifi
      - media_player.zolder_werkkamer_stereo
    state:
      - "idle"
      - "off"
    for: "00:30:00"
  - condition: numeric_state
    entity_id:
      - sensor.battery
    above: 95
  - or:
      - condition: template
        value_template: >
          {{
            states('sensor.iphone_van_martijn_battery_level') | float(0) > 95
            and is_state('binary_sensor.iphone_martijn_on_charger', 'on')
          }}
      - alias: "iPhone not on charger"
        condition: state
        entity_id: binary_sensor.iphone_martijn_on_charger
        state: "off"
action:
  - alias: "Turn off plug"
    service: switch.turn_off
    target:
      entity_id: switch.bureau_martijn
