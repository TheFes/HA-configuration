platform: template
lights:
  zolder_bol_template:
    unique_id: 72bae41e-6235-4ace-b4b1-12dfdec05800
    friendly_name: "Zolder Bol Template"
    level_template: "{{ state_attr('light.zolder_bol', 'brightness') | default(0, True) }}"
    value_template: "{{ false if is_state('switch.bureau_marleen', 'off') else is_state('light.zolder_bol', 'on') }}"
    temperature_template: "{{ state_attr('light.zolder_bol', 'color_temp') | default(140, True) }}"
    min_mireds_template: "{{ state_attr('light.zolder_bol', 'min_mireds') | int(140) }}"
    max_mireds_template: "{{ state_attr('light.zolder_bol', 'max_mireds') | int(650) }}"
    availability_template: "{{ states('light.zolder_bol') | bool('na') is boolean or states('switch.bureau_marleen') | bool('na') is boolean }}"
    turn_on:
      - if:
          - alias: "Desk plug off?"
            condition: state
            entity_id: switch.bureau_marleen
            state: "off"
        then:
          - alias: "Turn on desk plug"
            service: switch.turn_on
            target:
              entity_id: switch.bureau_marleen
          - alias: "Wait until light is available"
            wait_template: "{{ states('light.zolder_bol') | bool('na') is boolean }}"
            timeout:
              seconds: 10
      - alias: "Turn light on"
        service: light.turn_on
        target:
          entity_id: light.zolder_bol
    turn_off:
      - alias: "Turn light off"
        service: light.turn_off
        target:
          entity_id: light.zolder_bol
    set_level:
      service: light.turn_on
      data:
        entity_id: light.zolder_bol
        brightness: "{{ brightness }}"
    set_temperature:
      service: light.turn_on
      data:
        entity_id: light.zolder_bol
        color_temp: "{{ color_temp }}"
