- trigger:
    - platform: state
      entity_id: &e1 sensor.afvalwijzer_restgft
      attribute: days_until_collection_date
      not_to: none
      variables: &var1
        sensor: *e1
        name: "{{ 'Grey & Green' if is_state('input_select.dashboard_language', 'EN') else 'Rest & GFT' }}"
    - platform: event
      event_type: event_template_reloaded
      variables: *var1
    - platform: state
      entity_id: input_select.dashboard_language
      variables: *var1
  sensor:
    - unique_id: 9d6b50c5-6059-4d91-ae4e-43dcd095987c
      name: "{{ name }}"
      state: &state >-
        {%- set lang = states('input_select.dashboard_language') %}
        {%- set collection_date = as_local(as_datetime(state_attr(sensor, 'year_month_day_date'))).date() %}
        {%- set days = ['maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag', 'zaterdag', 'zondag' ] %}
        {%- set days_until = state_attr(sensor, 'days_until_collection_date') %}
        {%- if days_until <= 1 %}
          {{ (['Today', 'Tomorrow'] if lang == 'EN' else ['Vandaag', 'Morgen'])[days_until] }}
        {%- elif days_until < 7 - now().isoweekday() %}
          {{ collection_date.strftime('%A') if lang == 'EN' else days[collection_date.weekday()] | title }}
        {%- elif days_until < 14 - now().isoweekday() %}
          {%- if lang == 'EN' %}
            {{ collection_date.strftime('%A') ~ ' next week' }}
          {%- else %}
            {{ 'Volgende week ' ~ days[collection_date.weekday()] }}
          {%- endif %}
        {%- else %}
          {%- if lang == 'EN' %}
            {{ 'In ' ~ (days_until / 7) | round(0, 'ceil') ~ ' weeks' }}
          {%- else %}
            {{ 'Over ' ~ (days_until / 7) | round(0, 'ceil') ~ ' weken' }}
          {%- endif %}
        {%- endif %}
      icon: mdi:trash-can
      availability: &availabity "{{ not states(sensor) in [ 'unknown', 'unavailable', 'Geen' ] }}"
      attributes: &attributes
        waste_type: >
          {{
            name if states(sensor) != states('sensor.afvalwijzer_kerstbomen')
            else name | replace(' & ', ', ') ~ ' & ğŸŒ²'
          }}
        collection_date: >
          {{ as_local(as_datetime(state_attr(sensor, 'year_month_day_date'))).date() }}
        in_two_weeks: >
          {{ now().date() - as_local(as_datetime(state_attr(sensor, 'year_month_day_date'))).date() <= timedelta(weeks=2) }}

- trigger:
    - platform: state
      entity_id: &e2 sensor.afvalwijzer_dhm
      attribute: days_until_collection_date
      not_to: none
      variables: &var2
        sensor: *e2
        name: "{{ 'Blue & Orange' if is_state('input_select.dashboard_language', 'EN') else 'Papier & PMD' }}"
    - platform: event
      event_type: event_template_reloaded
      variables: *var2
    - platform: state
      entity_id: input_select.dashboard_language
      variables: *var2
  sensor:
    - unique_id: 821b207c-5c06-4da4-9e8c-a5790e6e4c8c
      name: "{{ name }}"
      state: *state
      icon: mdi:trash-can-outline
      availability: *availabity
      attributes: *attributes
