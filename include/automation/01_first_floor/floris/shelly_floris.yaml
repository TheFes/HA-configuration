id: 49ca8407-cbd4-4202-9712-0e225c60334c
alias: "Actions with wall button Floris"
mode: parallel
max_exceeded: silent
trigger:
  - trigger: state
    entity_id: event.sonoff_floris_sonoff_floris
    not_from: unavailable
action:
  - alias: "Click type?"
    choose:
      - conditions:
          - alias: "Short?"
            condition: template
            value_template: "{{ trigger.to_state.attributes.event_type == 'single_press' }}"
        sequence:
          - if: >
              {{
                area_entities('slaapkamer_floris')
                  | select('in', label_entities('lights_off_long_press'))
                  | select('is_state', 'on')
                  | list
                  | count > 0
              }}
            then:
              - alias: "Light off"
                action: light.turn_off
                target:
                  entity_id: >
                    {{
                      area_entities('slaapkamer_floris')
                        | select('in', label_entities('lights_off_long_press'))
                        | select('is_state', 'on')
                        | list
                    }}
            else:
              - alias: "Turn on main light"
                action: light.turn_on
                target:
                  entity_id: light.floris_template
      - conditions:
          - alias: "Double?"
            condition: template
            value_template: "{{ trigger.to_state.attributes.event_type == 'double_press' }}"
        sequence:
          - alias: "Light on 100% brightness"
            action: light.turn_on
            target:
              entity_id: light.floris
            data:
              brightness: 255
      - conditions:
          - alias: "Long?"
            condition: template
            value_template: "{{ trigger.to_state.attributes.event_type == 'long_press' }}"
        sequence:
          - action: script.turn_on
            target:
              entity_id: script.bedtime_floris_routine
