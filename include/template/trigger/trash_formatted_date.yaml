- trigger:
    - platform: state
      entity_id: sensor.afvalwijzer_restgft
      attribute: days_until_collection_date
      not_to: none
  sensor:
    - unique_id: 9d6b50c5-6059-4d91-ae4e-43dcd095987c
      name: "Rest & GFT"
      icon: mdi:trash-can
      <<: &config
        state: >-
          {%- set collection_date = as_datetime(trigger.to_state.attributes.year_month_day_date).date() %}
          {%- set days = ['maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag', 'zaterdag', 'zondag' ] %}
          {%- set days_until = trigger.to_state.attributes.days_until_collection_date %}
          {%- if days_until <= 1 %}
            {{ ['Vandaag', 'Morgen'][days_until] }}
          {%- elif days_until < 7 - now().isoweekday() %}
            {{ collection_date.strftime('%A') if lang == 'EN' else days[collection_date.weekday()] | title }}
          {%- elif days_until < 14 - now().isoweekday() %}
            {{ 'Volgende week ' ~ days[collection_date.weekday()] }}
          {%- else %}
            {{ 'Over ' ~ (days_until / 7) | round(0, 'ceil') ~ ' weken' }}
          {%- endif %}
        availability: "{{ trigger.to_state.state not in [ 'unknown', 'unavailable', 'Geen' ] }}"
        attributes:
          waste_type: >
            {{
              this.name if trigger.to_state.state != states('sensor.afvalwijzer_kerstbomen')
              else this.name | replace(' & ', ', ') ~ ' & ðŸŒ²'
            }}
          collection_date: >
            {{ as_datetime(trigger.to_state.attributes.year_month_day_date).date() }}
          in_two_weeks: >
            {{ now().date() - as_datetime(trigger.to_state.attributes.year_month_day_date).date() <= timedelta(weeks=2) }}

- trigger:
    - platform: state
      entity_id: sensor.afvalwijzer_dhm
      attribute: days_until_collection_date
      not_to: none
  sensor:
    - unique_id: 821b207c-5c06-4da4-9e8c-a5790e6e4c8c
      name: "Papier & PMD"
      icon: mdi:trash-can-outline
      <<: *config
