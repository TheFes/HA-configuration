id: b8f7c143-ca0d-4fbc-b98e-fec9870fd284
alias: "00 - Alert for Too Good To Go"
trigger:
  - platform: state
    entity_id:
      - sensor.tgtg_bakker_ochtend_box
      - sensor.tgtg_plus_magic_box
    to: ~
action:
  - alias: "Send or dismiss"
    choose:
      - conditions: "{{ trigger.to_state.state == '0' }}"
        sequence:
          - alias: "Dismiss notification"
            service: notify.mobile_app_pixel_7_pro
            data:
              message: "clear_notification"
              data:
                tag: TGTG-{{ trigger.entity_id }}
    default:
      - alias: "Send notification"
        service: notify.mobile_app_pixel_7_pro
        data:
          title: "{{ trigger.to_state.name.split(' - ')[0] }} beschikbaar"
          message: "Er {{ iif(trigger.to_state.state == '1','is', 'zijn') }} er nog {{ trigger.to_state.state }}"
          data:
            tag: TGTG-{{ trigger.entity_id }}
            channel: TGTG
            ttl: 0
            priority: high
            notification_icon: mdi:baguette
            clickAction: "{{ trigger.to_state.attributes['Item URL'] }}"
