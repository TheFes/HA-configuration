platform: template
covers:
  overloop_zolder_template:
    unique_id: f257aa95-bd57-4f22-baf3-613754cb23ab
    device_class: shade
    availability_template: &availability >
      {%- set source = this.entity_id | replace('_template', '') %}
      {{ not states(source) in ['unknown', 'unavailable'] }}
    friendly_name: "Screen Overloop Zolder"
    position_template: &position >
      {%- set source = this.entity_id | replace('_template', '') %}
      {%- set boolean = 'input_boolean.cover_' ~ this.entity_id | replace('cover.', '') | replace('template', 'invert') %}
      {%- if is_state(boolean, 'on') %}
        {{ 100 - state_attr(source, 'current_position') | float(0) }}
      {%- else %}
        {{ state_attr(source, 'current_position') | float(0) }}
      {%- endif %}
    open_cover: &open
      service: >
        {%- set boolean = 'input_boolean.cover_' ~ this.entity_id | replace('cover.', '') | replace('template', 'invert') %}
        {%- if is_state(boolean, 'on') %}
          cover.close_cover
        {%- else %}
          cover.open_cover
        {%- endif %}
      target:
        entity_id: "{{ this.entity_id | replace('_template', '') }}"
    close_cover: &close
      service: >
        {%- set boolean = 'input_boolean.cover_' ~ this.entity_id | replace('cover.', '') | replace('template', 'invert') %}
        {%- if is_state(boolean, 'on') %}
          cover.open_cover
        {%- else %}
          cover.close_cover
        {%- endif %}
      target:
        entity_id: "{{ this.entity_id | replace('_template', '') }}"
    stop_cover: &stop
      service: cover.stop_cover
      target:
        entity_id: >
          {{ this.entity_id | replace('_template', '') }}
    set_cover_position: &set_position
      service: cover.set_cover_position
      target:
        entity_id: >
          {{ this.entity_id | replace('_template', '') }}
      data:
        position: >
          {%- set boolean = 'input_boolean.cover_' ~ this.entity_id | replace('cover.', '') | replace('template', 'invert') %}
          {%- if is_state(boolean, 'on') %}
            {{ 100 - position }}
          {%- else %}
            {{ position }}
          {%- endif %}

  slaapkamer_zolder_template:
    unique_id: 95fb6193-3557-435e-8b5b-8fdf8bdacd3f
    device_class: shade
    availability_template: *availability
    friendly_name: "Screen Slaapkamer Zolder"
    position_template: *position
    open_cover: *open
    close_cover: *close
    stop_cover: *stop
    set_cover_position: *set_position
