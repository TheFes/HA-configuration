slaapkamer_plafond_toggle:
  alias: "F2B - Actions for template light master bedroom"
  icon: "mdi:light-flood-down"
  mode: restart
  sequence:
    - alias: "On"
      if: "{{ action == 'on' }}"
      then:
        - alias: "Light off no transition active?"
          choose:
            - conditions:
                - alias: "Not yet dimmed?"
                  condition: state
                  entity_id: input_boolean.dimmed_slaapkamer
                  state: "off"
              sequence:
                - alias: "Time of day?"
                  choose:
                    - alias: "Morning"
                      conditions:
                        - condition: time
                          after: input_datetime.slaapkamer_transition_on
                          before: input_datetime.slaapkamer_transition_off
                      sequence:
                        - alias: "Turn on light dimmed"
                          service: light.turn_on
                          target:
                            entity_id: light.slaapkamer_plafond
                          data:
                            brightness: 1
                            color_temp_kelvin: 2000
                        - delay: 0.1
                        - alias: "Increase brightness"
                          service: light.turn_on
                          target:
                            entity_id: light.slaapkamer_plafond
                          data:
                            brightness_pct: 100
                            transition: 6535
                        - alias: "Turn on input_boolean"
                          service: input_boolean.turn_on
                          target:
                            entity_id: input_boolean.dimmed_slaapkamer
                    - conditions:
                        - alias: "Evening"
                          condition: or
                          conditions:
                            - condition: time
                              after: input_datetime.slaapkamer_dim_on
                            - condition: time
                              before: input_datetime.slaapkamer_dim_off
                      sequence:
                        - alias: "Light on"
                          service: light.turn_on
                          target:
                            entity_id: light.slaapkamer_plafond
                          data:
                            brightness: 128
                        - delay: 0.1
                        - alias: "Dim light"
                          service: light.turn_on
                          target:
                            entity_id: light.slaapkamer_plafond
                          data:
                            brightness_pct: 10
                            color_temp_kelvin: 2200
                            transition: 60
                        - delay: 60
                        - alias: "Turn on input_boolean"
                          service: input_boolean.turn_on
                          target:
                            entity_id: input_boolean.dimmed_slaapkamer
                  default:
                    - alias: "Light on 100% during daytime"
                      service: light.turn_on
                      target:
                        entity_id: light.slaapkamer_plafond
                      data:
                        brightness: 255
                        color_temp_kelvin: 6535
                    - alias: "Turn on input_boolean"
                      service: input_boolean.turn_on
                      target:
                        entity_id: input_boolean.dimmed_slaapkamer
          default:
            - alias: "Light on with current setting if it has already been turned on before"
              service: light.turn_on
              target:
                entity_id: light.slaapkamer_plafond
      else:
        - alias: "Input boolean on"
          service: input_boolean.turn_on
          target:
            entity_id: input_boolean.dimmed_slaapkamer
        - alias: "Dim light first in evening"
          choose:
            - conditions:
                - condition: time
                  after: "22:00:00"
                  before: "06:00:00"
              sequence:
                - service: light.turn_on
                  target:
                    entity_id: light.slaapkamer_plafond
                  data:
                    brightness: 1
                    transition: 5
        - alias: "Light off"
          service: light.turn_off
          target:
            entity_id: light.slaapkamer_plafond
