id: 55509fd0-bdce-4cd2-86dc-2a8bee22b1b0
alias: "F1P - Turn graafmachine orange or green just before wake time"
trigger:
  - platform: template
    value_template: >
      {% set end = today_at(states('input_datetime.pepijn_time_awake')) %}
      {% set start = end - timedelta(minutes=states('input_number.leestijd_pepijn')|int) %}
      {{ start < now() < end }}
    id: orange
  - platform: time
    at: input_datetime.pepijn_time_awake
    id: green
action:
  - if: "{{ trigger.id == 'orange' }}"
    then:
      - service: light.turn_on
        target:
          entity_id: light.graafmachine
        data:
          brightness_pct: 1
          color_name: "orange"
      - service: script.turn_on
        target:
          entity_id: script.transition_lights
        data:
          variables:
            lights:
              - light.graafmachine
            br_start_pct: 1
            br_end_pct: 100
            use_ct: false
            duration: "{{ (today_at(states('input_datetime.pepijn_time_awake')) - now()).seconds }}"
    else:
      - service: script.turn_on
        target:
          entity_id: script.transition_lights
        data:
          variables:
            lights:
              - light.graafmachine
            use_br: false
            use_ct: false
            rgb_end:
              - 0
              - 255
              - 0
            duration: 10
