trigger:
  - platform: state
    entity_id:
      - input_boolean.vakantie
      - input_boolean.gast
      - zone.home
  - platform: state
    entity_id: sensor.pixel_7_pro_charger_type
    to: "wireless"
  - platform: state
    entity_id: sensor.de_buurvrouw_battery_state
    to: "Charging"
  - platform: state
    entity_id: sensor.house_mode
    to: ~
  - platform: state
    entity_id: light.groep_beneden
    to: "off"
  - platform: homeassistant
    event: start
  - platform: event
    event_type: event_template_reloaded
  - platform: time
    at: "06:00:00"
  - platform: time
    at: "23:00:00"
sensor:
  - unique_id: 7f99fde6-48f5-48f4-b7c1-31bfbfe738dc
    name: House Mode
    state: >-
      {%- if is_state('zone.home', '0')
          and is_state('input_boolean.gast', 'off')
          and is_state('input_boolean.vakantie', 'on') %}
        Vakantie
      {%- elif is_state('zone.home', '0')
          and is_state('input_boolean.gast', 'on') %}
        Gast
      {%- elif is_state('zone.home', '0') %}
        Afwezig
      {%-
        elif
          states('zone.home') | int(0) > 0
          and
            (
              as_timestamp(now()) | timestamp_custom('%H:%M') >= '22:30'
              or now().hour < 6
            )
          and is_state('light.groep_beneden', 'off')
          and
            (
              is_state('sensor.pixel_7_pro_charger_type', 'wireless')
              or not is_state('person.martijn', 'home')
            )
          and
            (
              is_state('sensor.de_buurvrouw_battery_state', 'Charging')
              or not is_state('person.marleen', 'home')
            )
          
        %}
        Slapen
      {%- else %}
        Thuis
      {%- endif %}
    icon: >-
      {%- if is_state('sensor.house_mode', 'Gast') %}
        mdi:account
      {%- elif is_state('sensor.house_mode', 'Afwezig') %}
        mdi:home-outline
      {%- elif is_state('sensor.house_mode', 'Vakantie') %}
        mdi:bag-suitcase
      {%- elif is_state('sensor.house_mode', 'Slapen') %}
        mdi:bed
      {%- else %}
        mdi:home
      {%- endif %}
